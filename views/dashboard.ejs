<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css" />
  </head>
  <body>
    <div class="layout">
      <!-- Include Sidebar -->
      <%- include('partials/sidebar') %>
      <!-- Ini menyertakan sidebar.ejs -->

      <!-- Main Content -->
      <main class="main-content">
        <div class="top-bar">
          <button
            class="create-report"
            onclick="window.location.href='/laporan';"
          >
            Buat Laporan Baru
          </button>

          <div class="filter-group">
            <button class="filter active">All</button>
            <button class="filter">Laporan Kehilangan</button>
            <button class="filter">Laporan Penemuan</button>
            <button class="filter">Filter ‚åÑ</button>
          </div>
        </div>

        <div class="search-bar">
          <input type="text" placeholder="Search" />
          <button class="search-btn">üîç</button>
        </div>

        <div class="card-grid">
          <% if (reports && reports.length > 0) { %> <%
          reports.forEach(function(report) { %>
          <div class="card">
            <div class="card-image">
              <img
                src="/<%= report.foto_barang %>"
                alt="gambar barang"
                class="card-image"
              />
            </div>
            <h3><%= report.nama_barang %></h3>
            <p><strong><%= report.jenis_laporan %></strong></p>
            <p>Lokasi: <%= report.lokasi %></p>
            <p>Tanggal: <%= report.tanggal_kejadian %></p>

<!-- Baris: Status + Bookmark -->
<div class="status-bookmark-row">
  <span class="badge <%= report.status.toLowerCase().replace(/\s+/g, '-') %>">
    <%= report.status %>
  </span>

  <form class="bookmark-form" data-id="<%= report.id_laporan %>">
  <button type="submit" class="bookmark-btn" title="<%= report.is_bookmarked ? 'Hapus Bookmark' : 'Simpan Bookmark' %>">
    <img src="/images/<%= report.is_bookmarked ? 'bookmark.png' : 'bookmark-putih.png' %>" 
         alt="<%= report.is_bookmarked ? 'Unbookmark' : 'Bookmark' %>" 
         style="width: 20px; height: 20px;" />
  </button>
</form>
</div>

<!-- Baris: Tombol bawah -->
<div class="buttons">
  <button class="detail-btn">See Detail</button>
  <form action="/claim/<%= report.id_laporan %>" method="GET">
    <button type="submit" class="claim-btn">Claim</button>
  </form>
</div>

          <% }) %> <% } else { %>
          <p>No reports available.</p>
          <% } %>
        </div>
      </main>
    </div>
  </body>
 <script>
  document.querySelectorAll('.bookmark-form').forEach(form => {
    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      const id_laporan = form.getAttribute('data-id');

      const response = await fetch('/toggle-bookmark', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id_laporan })
      });

      const result = await response.json();

      if (result.success) {
        const img = form.querySelector('img');
        const btn = form.querySelector('button');

        if (result.is_bookmarked) {
          img.src = '/images/bookmark.png';
          img.alt = 'Unbookmark';
          btn.title = 'Hapus Bookmark';
        } else {
          img.src = '/images/bookmark-putih.png';
          img.alt = 'Bookmark';
          btn.title = 'Simpan Bookmark';
        }
      } else {
        alert('Gagal mengubah bookmark');
      }
    });
  });
</script>
</html>
